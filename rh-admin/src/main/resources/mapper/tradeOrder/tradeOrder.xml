<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ntnikka.modules.orderManager.dao.TradeOrderDao">
	
	<select id="queryOrderDataForBarChart" parameterType="map" resultType="java.util.HashMap">
		SELECT SUM(order_amount) as total_count , DATE_FORMAT(create_time,'%y-%m-%d') as dt
		from trade_order
		where status = 1
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
	    GROUP BY dt
	</select>

	<select id="queryOrderDataForBarChartByMerchant" parameterType="map" resultType="java.util.HashMap">
		SELECT SUM(order_amount) as total_count , DATE_FORMAT(create_time,'%y-%m-%d') as dt
		from trade_order
		where status = 1
		<if test="ids != null and ids.size() > 0 ">
			and merchant_id in
			<foreach collection="ids" item= "item" index ="index" open= "(" close =")" separator=",">
				${item}
			</foreach >
		</if>
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
		GROUP BY dt
	</select>

	<select id="queryTotalOrderCount" resultType="java.util.HashMap">
		select  count(1) as totalCount
		from trade_order
		where status = 1
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
	</select>

	<select id="queryToPayOrderCount" resultType="java.util.HashMap">
		select count(1) as toPayCount
		from trade_order
		where status = 0
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
	</select>

	<select id="queryFailOrderCount" resultType="java.util.HashMap">
		select count(1) as failCount
		from trade_order
		where status = 2
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
	</select>


	<select id="queryAllCountAndSum" resultType="java.util.HashMap">
		select  count(1) as totalCount , SUM(order_amount) as totalAmount
		from  trade_order
		<choose>
			<when test="starttime == '' and  endtime == ''">
				where TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				where  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
	</select>

	<select id="querySuccessCountAndSum" resultType="java.util.HashMap">
		select  count(1) as totalCount , SUM(order_amount) as totalAmount
		from  trade_order
		where status = 1
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
	</select>

	<select id="queryAllCountAndSumByMerchant" resultType="java.util.HashMap">
		select  count(1) as totalCount , SUM(order_amount) as totalAmount
		from  trade_order
		<choose>
			<when test="starttime == '' and  endtime == ''">
				where TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				where  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
		<if test="ids != null and ids.size() > 0 ">
			and merchant_id in
			<foreach collection="ids" item= "item" index ="index" open= "(" close =")" separator=",">
				${item}
			</foreach >
		</if>
	</select>

	<select id="querySuccessCountAndSumByMerchant" resultType="java.util.HashMap">
		select  count(1) as totalCount , SUM(order_amount) as totalAmount
		from  trade_order
		where status = 1
		<choose>
			<when test="starttime == '' and  endtime == ''">
				and TO_DAYS(create_time) = TO_DAYS(NOW())
			</when>
			<otherwise>
				and  DATE_FORMAT(create_time,'%y-%m-%d')
				between  DATE_FORMAT(#{starttime},'%y-%m-%d') and DATE_FORMAT(#{endtime},'%y-%m-%d')
			</otherwise>
		</choose>
		<if test="ids != null and ids.size() > 0 ">
			and merchant_id in
			<foreach collection="ids" item= "item" index ="index" open= "(" close =")" separator=",">
				${item}
			</foreach >
		</if>
	</select>

</mapper>